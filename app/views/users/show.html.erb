<div class="row">
  <div class="col-md-offset-4">
    <div class="card" style="width:400px">
      <img class="card-img-top img-circle" src=" <%= session[:myimage] %> " alt="Card image" style="width:150px;">
      <div class="card-body" style="padding-left:20px">
        <h4 class="card-title"> <%= session[:myname] %> </h4>
        <p class="card-text"> 性別:<%= session[:mygender] %> </p>
        <p class="card-text">  生年月日:<%= session[:myage] %> </p>
        <p class="card-text"> 住所: <%= session[:myaddress] %> </p>
        <a href="#" class="btn btn-primary" data-toggle="modal" data-target="#myModal">イイネ！したアイテムを見る</a>



      </div>
<!-- 以下modalの中身 -->
                <div class="modal fade" id="myModal">
                  <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">

                      <!-- Modal Header -->
                      <div class="modal-header">
                        <h4 class="modal-title">あなたがイイネ！したアイテム</h4>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                      </div>

                      <!-- Modal body -->
                      <div class="modal-body">
                        <!-- Modal body.. -->

                        <% if @likes.empty?  %>
                          いいねしたアイテムがありません
                        <% end %>


                        <% @likes.each do |like| %>
                         <% p = Product.find_by(id: like.product_id) %>
                         <% @likes_count = Like.where(product_id: p.id).count %>
                         <div class="" style="padding-bottom:20px;">
                           <a href="/products/<%= p.id %>">
                           <%= image_tag(p.image, :width => "158px") %>
                           <%= p.name %>
                           ¥<%= p.price %>
                           <span id="kinds"> # <%= p.category_id %> </span>
                           <span id="kinds"> # <%= p.state_id %> </span>
                           <span id="kinds"> # <%= p.scene_id %> </span>
                           <% if Like.find_by(customer_id: @current_customer, product_id: p.id) %>
                           <!-- @current_customer.idだとうまく挙動しなかった -->
                            <!-- いいね！済み -->
                            <%= link_to("/likes/#{p.id}/destroy", {method: "post"}, name: 'back') do %>
                            <!-- name: 'back' つけたけどこの画面にリダイレクトすることができなかった。 -->
                              <span class="fa fa-heart like-btn-unlike"></span>
                            <% end %>
                           <% else %>
                            <!-- いいね！していません -->
                            <%= link_to("/likses/#{p.id}/create", {method: "post"}, name: 'back') do %>
                              <span class="fa fa-heart like-btn"></span>
                            <% end %>
                           <% end %>

                           <%= @likes_count %>
                           </a>
                         </div>

                        <% end %>

<!-- フロントぐちゃぐちゃ -->

                      </div>



                      <div class="modal-body">
                        Modal body..
                      </div>

                      <!-- Modal footer -->
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">確認</button>
                      </div>

                    </div>
                  </div>
                </div>
<!-- 以上modalの中身 -->
    </div>
  </div>
</div>

<div class="row">

  <div class="col-md-offset-2">
    <h1>受け取ったカタログ</h1>
    <% @catalog.each do |catalog| %>
    <% object_name = catalog.product_id %>
    <% object_name = object_name.split(",") %>
    <% object_name = object_name.reverse %>
    <% update = catalog.updated_at %>
    <% giver_id = catalog.user_id %>
    <% giver = Customer.find_by(id: giver_id) %>
    <table class="table" style="width:500px; border: solid 1px;" >
    <a  href="/users/<%= catalog.id %>">
      <%= update %>に<%= giver.name %>からカタログギフトがプレゼントされました。
        <thead class="">
          <tr>
            <th></th>
            <th>商品</th>
            <th>カテゴリー</th>
            <th>商品説明</th>
          </tr>
        </thead>

        <% a = 0 %>
        <% object_name.each do |object_num| %>
          <% gift_product = Product.where(id: object_num) %>
          <% gift_product.each do |p| %>

            <tbody>
              <tr>
                <td> <%= image_tag(p.image, size: "60x60", alt: "Edit Entry") %> </td>
                <td> <%= p.name %> </td>
                <td> <%= p.category_id %> <br>
                     <%= p.state_id %> <br>
                     <%= p.scene_id %>
                </td>
                <td> <%= p.description %> </td>
                <% a = a+1 %>
              </tr>
            </tbody>
          <% end %>
        <% end %>
        </a>
    </table>
    <% end %>

  </div>






  <h1 class="col-md-offset-2">送ったカタログ</h1>
   <div class="col-md-offset-2">
         <% @forder.each do |finalorder| %>
         <% @pro = finalorder.product_id  %>
         <% @q = finalorder.quantity %>
         <% @update = finalorder.updated_at %>
         <% @proid = @pro.split(",")  %>
         <% @proidx = @proid.reverse  %>
         <% @quan = @q.split(",")  %>
         <% @quanx = @quan.reverse  %>
         <% @recipient = Customer.find_by(id: finalorder.recipient_id) %>
         <table class="table" style="width:500px; border: solid 1px;">
           <%= @update %>に<%= @recipient.name %>にプレゼントしました。
             <thead class="">
               <tr>
                 <th></th>
                 <th>商品名</th>
                 <th>カテゴリー</th>
                 <th>個数</th>
                 <th>When you bought</th>
               </tr>
             </thead>

         <%  a = 0;
          @proidx.each do |pr|
           @product = Product.where(id: pr)
           @product.each do |p|

              %>
              <tbody>
                <tr>
                  <td> <%= image_tag(p.image, size: "60x60", alt: "Edit Entry") %> </td>
                  <td> <%= p.name %> </td>
                  <td> <%= p.category_id %></td>
                  <td> <%= @quanx[a] %> Items</td>
                  <td> <%= @update %></td>
                  <% a = a+1 %>
                </tr>
              </tbody>

         <%
       end

         end
         %>



         <!-- 難しいなあ -->
         <!-- ソヌまじすごい　using more than two roops at the same time -->


             <!-- <td style="width:500px"><%= @proid %></td>
             <td><%= link_to 'Show', finalorder %></td>
             <td><%= link_to 'Edit', edit_finalorder_path(finalorder) %></td>
             <td><%= link_to 'Destroy', finalorder, method: :delete, data: { confirm: 'Are you sure?' } %></td> -->


             <!-- 重複する配列が表示されない -->
         <% end %>
         </table>



   </div>
</div>
